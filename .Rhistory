devtools::load_all()
knitr::opts_chunk$set(
echo = TRUE,
cache = TRUE,
warning = FALSE,
message = FALSE
)
devtools::load_all()
library(tidyr)
library(dplyr)
library(kableExtra)
library(ggplot2)
library(forcats)
library(readr)
theme_set(theme_bw() + theme(axis.title = element_text()))
plotting_df <- mc_trees_to_A_infects_B(my_id = 27,
par_ests = par_ests,
mc_trees = mc_trees,
output = "matrix")
par_ests <- c("Intercept" = -.72690792,
"smear" = -.09322607,
"hiv_neg_pos" = -0.36415841,
"hiv_unk_pos" = -0.56817810,
"rel_time" = .345552628)
mc_trees <-  sample_mc_trees(clusters %>% filter(cluster_id == 27),
B = 100,
multiple_outside_transmissions = FALSE,
covariate_names = names(par_ests))
knitr::opts_chunk$set(
echo = TRUE,
cache = TRUE,
warning = FALSE,
message = FALSE
)
devtools::load_all()
library(tidyr)
library(dplyr)
library(kableExtra)
library(ggplot2)
library(forcats)
library(readr)
theme_set(theme_bw() + theme(axis.title = element_text()))
data(tb_clean)
clusters <- tb_clean %>%
dplyr::filter(PCR.Cluster != "") %>%
dplyr::mutate(smear = ifelse(spsmear == "Positive",
1, 0),
cluster_id = PCR.Cluster,
hiv_f = forcats::fct_collapse(hivstatus,
pos = c("Positive"),
neg = c("Negative"),
unk = c("Unknown", "Not offered",
"Refused")),
age = readr::parse_number(ageatrept)) %>%
dplyr::mutate(hiv_neg_pos = ifelse(hiv_f == "neg", 1, 0),
hiv_unk_pos = ifelse(hiv_f == "unk", 1, 0)) %>%
dplyr::group_by(cluster_id) %>%
dplyr::mutate(rel_time = as.numeric(datecoll - min(datecoll)) / 365) %>%
dplyr::mutate(cluster_size = dplyr::n()) %>%
dplyr::ungroup() %>%
dplyr::mutate(race_f = forcats::fct_collapse(race,
white = "White",
black = "Black or African American",
asian = "Asian")) %>%
dplyr::mutate(race_asian_white = ifelse(race_f == "asian", 1, 0),
race_black_white = ifelse(race_f == "black", 1, 0)) %>%
dplyr::select(cluster_id, smear,
hiv_neg_pos,
hiv_unk_pos,
rel_time,
race_asian_white,
race_black_white,
cluster_size)
par_ests <- c("Intercept" = -.72690792,
"smear" = -.09322607,
"hiv_neg_pos" = -0.36415841,
"hiv_unk_pos" = -0.56817810,
"rel_time" = .345552628)
mc_trees <-  sample_mc_trees(clusters %>% filter(cluster_id == 27),
B = 100,
multiple_outside_transmissions = FALSE,
covariate_names = names(par_ests))
plotting_df <- mc_trees_to_A_infects_B(my_id = 27,
par_ests = par_ests,
mc_trees = mc_trees,
output = "matrix")
plotting_df <- mc_trees_to_A_infects_B(my_id = 27,
par_ests = par_ests,
mc_trees = mc_trees,
output = "tidy")
ggplot(data = plotting_df) +
geom_tile(aes(y = factor(infector_id),
x = factor(infected_id),
fill = prob * 100)) +
theme_bw(base_size = 10) +
labs(title = "Estimated transmission probability of TB from person A to B",
subtitle = sprintf("Individuals in cluster %s", 27),
y = "Infector ID",
x = "Infected ID") +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.border = element_blank()) +
scale_fill_gradient(low = "gray90",
high = "black",
name = latex2exp::TeX("Prob. A infects B (%)"),
na.value = "white")
plotting_df <- mc_trees_to_A_infects_B(my_id = 27,
par_ests = par_ests,
mc_trees = mc_trees,
output = "matrix")
plotting_df
devtools::load_all()
knitr::opts_chunk$set(
echo = TRUE,
cache = TRUE,
warning = FALSE,
message = FALSE
)
devtools::load_all()
library(tidyr)
library(dplyr)
library(kableExtra)
library(ggplot2)
library(forcats)
library(readr)
theme_set(theme_bw() + theme(axis.title = element_text()))
data(tb_clean)
clusters <- tb_clean %>%
dplyr::filter(PCR.Cluster != "") %>%
dplyr::mutate(smear = ifelse(spsmear == "Positive",
1, 0),
cluster_id = PCR.Cluster,
hiv_f = forcats::fct_collapse(hivstatus,
pos = c("Positive"),
neg = c("Negative"),
unk = c("Unknown", "Not offered",
"Refused")),
age = readr::parse_number(ageatrept)) %>%
dplyr::mutate(hiv_neg_pos = ifelse(hiv_f == "neg", 1, 0),
hiv_unk_pos = ifelse(hiv_f == "unk", 1, 0)) %>%
dplyr::group_by(cluster_id) %>%
dplyr::mutate(rel_time = as.numeric(datecoll - min(datecoll)) / 365) %>%
dplyr::mutate(cluster_size = dplyr::n()) %>%
dplyr::ungroup() %>%
dplyr::mutate(race_f = forcats::fct_collapse(race,
white = "White",
black = "Black or African American",
asian = "Asian")) %>%
dplyr::mutate(race_asian_white = ifelse(race_f == "asian", 1, 0),
race_black_white = ifelse(race_f == "black", 1, 0)) %>%
dplyr::select(cluster_id, smear,
hiv_neg_pos,
hiv_unk_pos,
rel_time,
race_asian_white,
race_black_white,
cluster_size)
par_ests <- c("Intercept" = -.72690792,
"smear" = -.09322607,
"hiv_neg_pos" = -0.36415841,
"hiv_unk_pos" = -0.56817810,
"rel_time" = .345552628)
mc_trees <-  sample_mc_trees(clusters %>% filter(cluster_id == 27),
B = 10000,
multiple_outside_transmissions = FALSE,
covariate_names = names(par_ests))
plotting_df <- mc_trees_to_A_infects_B(my_id = 27,
par_ests = par_ests,
mc_trees = mc_trees,
output = "matrix")
ggplot(data = plotting_df) +
geom_tile(aes(y = factor(infector_id),
x = factor(infected_id),
fill = prob * 100)) +
theme_bw(base_size = 10) +
labs(title = "Estimated transmission probability of TB from person A to B",
subtitle = sprintf("Individuals in cluster %s", 27),
y = "Infector ID",
x = "Infected ID") +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.border = element_blank()) +
scale_fill_gradient(low = "gray90",
high = "black",
name = latex2exp::TeX("Prob. A infects B (%)"),
na.value = "white")
plotting_df <- mc_trees_to_A_infects_B(my_id = 27,
par_ests = par_ests,
mc_trees = mc_trees,
output = "tidy")
ggplot(data = plotting_df) +
geom_tile(aes(y = factor(infector_id),
x = factor(infected_id),
fill = prob * 100)) +
theme_bw(base_size = 10) +
labs(title = "Estimated transmission probability of TB from person A to B",
subtitle = sprintf("Individuals in cluster %s", 27),
y = "Infector ID",
x = "Infected ID") +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.border = element_blank()) +
scale_fill_gradient(low = "gray90",
high = "black",
name = latex2exp::TeX("Prob. A infects B (%)"),
na.value = "white")
devtools::check()
pkgdown::build_articles()
getwd()
setwd("../..")
pkgdown::build_articles()
<<<<<<< HEAD
pkgdown::preview_site()
pkgdown::build_home()
pkgdown::build_articles()
pkgdown::build_articles()
pkgdown::build_articles()
pkgdown::build_articles()
pkgdown::build_home()
pkgdown::build_articles_index()
pkgdown::build_articles_index()
pkgdown::build_home()
pkgdown::build_home()
pkgdown::build_articles_index()
pkgdown::build_articles_index()
pkgdown::build_site()
warnings()
pkgdown::build_articles_index()
pkgdown::build_home()
pkgdown::build_articles_index()
pkgdown::build_home()
pkgdown::build_home()
pkgdown::build_articles_index()
pkgdown::build_articles_index()
pkgdown::build_reference()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_articles()
pkgdown::build_articles()
pkgdown::build_articles()
pgkdown::build_articles()
pkgdown::build_articles()
devtools::document()
devtools::check()
pkgdown::build_articles()
pkgdown::build_articles()
head(tb_clean)
=======
>>>>>>> fd400a1555a7a782265dd95dc3e8cb9f965adce0
