<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The model • InfectionTrees</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="The model">
<meta property="og:description" content="InfectionTrees">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">InfectionTrees</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/getting-started.html">Getting started with `InfectionTrees`</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/base-binary-simulations.html">Binary covariate model simulations</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/base-general-simulations.html">Multiple covariate model simulations</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/model-overview.html">The model</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/multiple-outside-binary-simulations.html">Binary covariate multiple outside transmissions model simulations</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/multiple-outside-transmissions-model.html">The multiple outside transmissions extension to the model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/skgallagher/InfectionTrees/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="model-overview_files/header-attrs-2.3/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/skgallagher/InfectionTrees/blob/master/vignettes/not-built-vignettes/model-overview.Rmd"><code>vignettes/not-built-vignettes/model-overview.Rmd</code></a></small>
      <div class="hidden name"><code>model-overview.Rmd</code></div>

    </div>

    
    
<div id="data-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#data-generation" class="anchor"></a>Data generation</h2>
<p>We can simulate from a branching process to form a data set of transmission trees or clusters (if we remove infector information from the transmission trees). We simulate <span class="math inline">\(K\)</span> branching processes where the primary infector in each tree is the root of each transmission tree and the probability of infection of another individual is where <span class="math inline">\(\bf{X}\)</span> is a covariate matrix and <span class="math inline">\(\beta\)</span> is a vector of coefficients, <span class="math display">\[
p_i = logit^{-1} (\bf{X}_i\bf{\beta}).
\]</span> Then the number of <strong>new</strong> infectious individuals infected by individual <span class="math inline">\(i\)</span> is <span class="math display">\[
N_i \sim Geometric(p_i).
\]</span></p>
<p>To form a branching process, we begin with an initial infector who is the root node who we index as (1,1). We then draw <span class="math inline">\(N_{(1,1)} \sim Geometric(p_{(1,1)})\)</span>, the number of infections produced by individual (1,1). These infections are part of generation 2 and so will be given indices <span class="math inline">\((2, 1), \dots, (2, N_{1,1})\)</span>.</p>
<p>The infection proceeds by marching <strong>down the generations</strong>. We first draw <span class="math inline">\(N_{(2,1)}\)</span> (if individual (2,1) exists) and give these new infections indices <span class="math inline">\((3, 1), \dots, (3, N_{(2,1)})\)</span>. We then draw <span class="math inline">\(N_{(2,2)}\)</span> and assign them indices <span class="math inline">\((3, N_{(2,1)} + 1), \dots, (3, \sum_{i=1}^{2}N_{2,i})\)</span>. We repeat this process until all infections in generation 3 are achieved. We then repeat the process beginning in generation 4. This infection process is repeated until it naturally terminates (or too a maximum number of infections are drawn). This process is illustrated in the below figure.</p>
<center>
<img src="images/bp-ex.png" title="fig:" alt="Branching process example">
</center>
<p>Then the data for a single transmission tree is a matrix of size <span class="math inline">\(n\)</span> where each row is the form <span class="math inline">\((label, g, i, \inf g, \inf i)\)</span>, where label denotes the individual and refers to her covariates, <span class="math inline">\((g,i)\)</span> is the indexing of individual <span class="math inline">\(A\)</span> and <span class="math inline">\((\inf g, \inf i)\)</span> is the infector ID or is denoted by <span class="math inline">\(\emptyset\)</span> to show that the infection originated from outside the cluster. For example, the above transmission tree <span class="math inline">\(T\)</span> becomes <span class="math display">\[ T = \left (
\begin{array}{ccccc}
A&amp; 1&amp; 1&amp; \emptyset&amp; \emptyset&amp;\\
B&amp; 2&amp; 1&amp; 1&amp; 1\\
C&amp; 2&amp; 2&amp; 1&amp; 1\\
D&amp; 3&amp; 1&amp; 2&amp; 2\\
E&amp; 3&amp; 2&amp; 2&amp; 2\\
F&amp; 3&amp; 3&amp; 2&amp; 2\\
G&amp; 3&amp; 4&amp; 3&amp; 1
\end{array}\right ),
\]</span> where <span class="math inline">\(\emptyset\)</span> means we assume the infection originates from the outside.</p>
</div>
<div id="computing-the-likelihood-of-a-tree-t" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-the-likelihood-of-a-tree-t" class="anchor"></a>Computing the likelihood of a tree <span class="math inline">\(T\)</span>
</h2>
<p>Because we know the transmission tree, we know <span class="math inline">\(N_{g,i}\)</span>, the number of infections transmitted by indivdual <span class="math inline">\((g,i)\)</span>. In terms of our above matrix <span class="math inline">\(T\)</span>, this is found by counting the number of infector generation, index pairs that equals the individual’s own generation, index pair. For example, in the above, <span class="math inline">\(N_{(1,1)} = 2, N_{(2,1)} = 0, N_{(2,2)} = 3, N_{(3,1)} = 1, N_{(3,2)} = 0, N_{(3,3)} = 0, N_{(4,1)} = 0\)</span>. The likelihood is then the product of independent geometric random variables with different probabilities of success <span class="math inline">\(p_i\)</span>, <span class="math display">\[
L(T) = \prod_{j=1}^n (1-p_j)p_j^{N_j},
\]</span> where we use <span class="math inline">\(j\)</span> as the <em>label</em> of the individual.</p>
</div>
<div id="computing-the-likelihood-of-an-observed-cluster-c" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-the-likelihood-of-an-observed-cluster-c" class="anchor"></a>Computing the likelihood of an observed cluster <span class="math inline">\(C\)</span>
</h2>
<p>In practice, we do not see the transmission tree <span class="math inline">\(T\)</span> but are instead working with a missing data problem. We observe a <em>cluster</em> <span class="math inline">\(C\)</span> of individuals, which is a collection of individuals along with their covariates. With respect to the above example matrix of <span class="math inline">\(T\)</span>, we would say <span class="math inline">\(C\)</span> is a subset of <span class="math inline">\(T\)</span>, specifically <span class="math inline">\(C = (A, B, C, D, E, F, G)^T\)</span>. We say that the size of <span class="math inline">\(C\)</span> is the number of individuals, <span class="math inline">\(|C| = n\)</span> or 7 in the above example. We neither know the generation-index pairs nor the infector IDs of the individuals.</p>
<p>We thus compute the <em>total</em> likelihood <span class="math inline">\(\mathcal{L}(C)\)</span> of a cluster, which is equal to the sum of the likelihood across the set of all permissible transmission trees, <span class="math inline">\(\mathcal{T}_C\)</span>, <span class="math display">\[
\mathcal{L}(C) = \sum_{T \in \mathcal{T}_C} L(T).
\]</span></p>
<div id="permissible-transmission-trees" class="section level3">
<h3 class="hasAnchor">
<a href="#permissible-transmission-trees" class="anchor"></a>Permissible Transmission Trees</h3>
<p>We say a transmission tree <span class="math inline">\(T \in \mathcal{T}_C\)</span> is <em>permissible</em> if it is a possible outcome of our data generation process. More specifcially, a transmission tree <span class="math inline">\(T\)</span> is permissible if it satifies the following criteria,</p>
<ol style="list-style-type: decimal">
<li>
<span class="math inline">\(T\)</span> has <span class="math inline">\(|C| = n\)</span> nodes.</li>
<li>The <span class="math inline">\(n\)</span> individuals are placed into <span class="math inline">\(g\)</span> successive generations where <span class="math inline">\(g\)</span> is between 1 and <span class="math inline">\(n\)</span>, inclusive.</li>
<li>The number of individuals in each generation is a <span class="math inline">\(g\)</span>-tuple <span class="math inline">\((n_1, \dots, n_g)\)</span> such that <span class="math inline">\(\sum_{j=1}^{g}{n_j} = n\)</span> and <span class="math inline">\(n_j &gt; 0\)</span> for <span class="math inline">\(j =1, \dots, g\)</span>.</li>
<li>There is exactly one root node so <span class="math inline">\(n_1 =1\)</span>.</li>
<li>Each individual is indexed by <span class="math inline">\((h,i)\)</span> which is the generation-index pair, where the index is the order of appearance within the generation, ranging between <span class="math inline">\(i=1, 2, \dots, n_h\)</span>.</li>
<li>For <span class="math inline">\(g &gt;1\)</span>, an individual <span class="math inline">\((g,i)\)</span> has exactly one infector from generation <span class="math inline">\(g-1\)</span>. For <span class="math inline">\(g=1\)</span>, the infector is denoted by <span class="math inline">\((\emptyset, \emptyset)\)</span>.</li>
<li>Each individual is assigned a label.</li>
</ol>
<p><strong>Ex. <span class="math inline">\(C = (A,B,C)\)</span> where individual <span class="math inline">\(A\)</span> has <span class="math inline">\(X_A = 1\)</span> and individuals <span class="math inline">\(B\)</span> and <span class="math inline">\(C\)</span> have <span class="math inline">\(X_B = X_C = 0\)</span></strong></p>
The below figures shows the different trees in <span class="math inline">\(\mathcal{T}_C\)</span> where <span class="math inline">\(|C| = 3\)</span>. The size of <span class="math inline">\(\mathcal{T}_C\)</span> is <span class="math inline">\(|\mathcal{T}_C| = 12\)</span> if we consider individuals <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, and <span class="math inline">\(C\)</span> to be distinguishable from one another. If we say individuals <span class="math inline">\(B\)</span> and <span class="math inline">\(C\)</span> are indistinguishable from one another because they have the same value of <span class="math inline">\(X_i=0\)</span>, then there are only 6 unique transmission trees.
<center>
<img src="images/enumerate-trees-3-2.png" title="fig:" alt="Enumerating the permissible trees of C">
</center>
</div>
</div>
<div id="obtaining-the-maximum-likelihood-estimate-mle-" class="section level2">
<h2 class="hasAnchor">
<a href="#obtaining-the-maximum-likelihood-estimate-mle-" class="anchor"></a>Obtaining the maximum likelihood estimate (MLE).</h2>
<p>For observed independent clusters <span class="math inline">\(C_1, \dots, C_M\)</span>, we would like to find the maximum likelihood estimate (MLE) of <span class="math inline">\(\beta\)</span> <span class="math display">\[
\hat{\beta}^{(MLE)} = \arg \max_\beta \prod_{m=1}^M\mathcal{L}(C_m).
\]</span></p>
<p>However, if <span class="math inline">\(|C_m| &gt; 15\)</span>, this is infeasible because the space of <span class="math inline">\(| \mathcal{T}_C|\)</span> is too large. We can instead sample permissible transmission trees to solve an equivalent problem, maximizing the average likelihood.</p>
<p>Let the average likelihood of a single cluster <span class="math inline">\(C\)</span> be given by <span class="math display">\[
\bar{\mathcal{L}}(C) = \frac{\mathcal{L}(C)}{|\mathcal{T}_C|}
\]</span> and note that since <span class="math inline">\(|\mathcal{T}_C|\)</span> is not dependent on <span class="math inline">\(\beta\)</span> then the MLE is the same for both <span class="math inline">\(\mathcal{L}(C)\)</span> and <span class="math inline">\(\bar{\mathcal{L}}(C)\)</span>, <span class="math display">\[
\hat{\beta}^{(MLE)} = \arg \max_\beta \prod_{m=1}^M\mathcal{L}(C_m)\\
 = \arg \max_\beta \prod_{m=1}^M\frac{1}{|\mathcal{T}_m|}\mathcal{L}(C_m)\\
= \arg \max_\beta \prod_{m=1}^M\bar{\mathcal{L}}(C_m).
\]</span></p>
<p>We approximate average likelihood for each cluster through Monte Carlo (MC) sampling. For a given cluster <span class="math inline">\(C\)</span>, we sample <span class="math inline">\(K\)</span> MC trees <span class="math inline">\(T_1, \dots, T_K \in \mathcal{T}_C\)</span>and form estimates <span class="math display">\[
\hat{\mathcal{L}}_K(C): = \frac{1}{K} \sum_{i=1}^KL(T_i) \overset{a.s.}{\to} \bar{\mathcal{L}}(C).
\]</span></p>
<p>We then form our estimate <span class="math inline">\(\hat{\beta}^{(MC)}\)</span> from Monte Carlo (MC) samples from <span class="math inline">\(\mathcal{T}_C\)</span>, <span class="math display">\[
\hat{\beta}^{(MC)} = \arg \max_\beta \prod_{m=1}^M\hat{\mathcal{L}}_K(Cm).
\]</span></p>
<p>The result is that (hopefully) <span class="math inline">\(\hat{\beta}^{(MC)} \approx \hat{\beta}^{(MLE)}\)</span> if <span class="math inline">\(K\)</span> is large. However, the limits of branching processes are sometimes found to be ‘non-standard’, meaning non-normal. As such, we demonstrate the usefulness of our methods through simulations.</p>
</div>
<div id="in-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#in-summary" class="anchor"></a>In summary</h2>
<p>We maximize the approximate likelihood over a set of MC sampled trees for our observed cluster <span class="math inline">\(C\)</span>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Shannon Gallagher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
