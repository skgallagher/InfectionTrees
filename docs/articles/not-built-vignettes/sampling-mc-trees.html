<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sampling transmission trees given a cluster  • InfectionTrees</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Sampling transmission trees given a cluster ">
<meta property="og:description" content="InfectionTrees">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">InfectionTrees</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/getting-started.html">Getting started with `InfectionTrees`</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/index.html">More...</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/skgallagher/InfectionTrees/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="sampling-mc-trees_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sampling transmission trees given a cluster <span class="math inline">\(C\)</span>
</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/skgallagher/InfectionTrees/blob/master/vignettes/not-built-vignettes/sampling-mc-trees.Rmd"><code>vignettes/not-built-vignettes/sampling-mc-trees.Rmd</code></a></small>
      <div class="hidden name"><code>sampling-mc-trees.Rmd</code></div>

    </div>

    
    
<div id="vignette-goals" class="section level2">
<h2 class="hasAnchor">
<a href="#vignette-goals" class="anchor"></a>Vignette goals</h2>
<p>In this vignette we will</p>
<ol style="list-style-type: decimal">
<li><p>Recap the properties of <span class="math inline">\(\mathcal{T}_C\)</span>, the sample space of permissible transmission trees in the base model.</p></li>
<li><p>Describe our algorithm of how to uniformly sample transmission trees <span class="math inline">\(T_C\)</span>.</p></li>
<li><p>Discuss the relationship between <span class="math inline">\(\mathcal{F}_C\)</span>, the sample space of permissible transmission trees in the multiple outside transmission model, and <span class="math inline">\(\mathcal{T}_C\)</span>.</p></li>
</ol>
</div>
<div id="properties-of-mathcalt_c" class="section level2">
<h2 class="hasAnchor">
<a href="#properties-of-mathcalt_c" class="anchor"></a>Properties of <span class="math inline">\(\mathcal{T}_C\)</span>
</h2>
<p><a href="model-overview.html">Recall</a> that <span class="math inline">\(\mathcal{T}_C\)</span> is the space of permissible transmission trees in the base model that result in the cluster <span class="math inline">\(C\)</span>. These are all the <strong>unique</strong> transmission trees that</p>
<ol style="list-style-type: decimal">
<li><p>have <span class="math inline">\(|C|= n\)</span> individuals</p></li>
<li><p>can be generated from our branching process model described in <a href="model-overview.html">the model overview</a></p></li>
</ol>
<p>Our transmission trees generated from our branching process are unique in that they are indexed by a generation-index ordered pair <span class="math inline">\((g,i)\)</span>. This is important because the indexing defines what is a unique transmission tree.</p>
<p>For example, consider the two transmission trees below, which have no indexing.</p>
<center>
<p><img src="images/non-unique-bps.png"></p>
</center>
<p>The only <em>visual</em> difference between these two transmission trees is that individuals ‘B’ and ‘C’ have swapped sapces. However, without indexing by both <span class="math inline">\(g\)</span> and <span class="math inline">\(i\)</span> we cannot distinguish between the two trees. We use indexing ordered pairs so we do not oversample ‘equivalent’ transmission trees.</p>
<p><a href="https://en.wikipedia.org/wiki/Cayley%27s_formula">Cayley’s formula</a> says that the number of trees (not necessarily transmission trees) is <span class="math inline">\(n^{n-2}\)</span>. This number is a lower bound for us because our transmission trees are special because of their indexing and having exactly 1 individual in generation 1. The practical consequence is that the number of transmission trees is <strong>very large</strong> for <span class="math inline">\(n\)</span> as small as 15 and is hence practically infeasible to enumerate all transmission trees in <span class="math inline">\(\mathcal{T}_C\)</span>. This is why we must sample from <span class="math inline">\(\mathcal{T}_C\)</span>.</p>
</div>
<div id="the-algorithm" class="section level2 tabset">
<h2 class="hasAnchor">
<a href="#the-algorithm" class="anchor"></a>The algorithm</h2>
<p>We draw trees from <span class="math inline">\(\mathcal{T}_C\)</span> in the following manner</p>
<ol style="list-style-type: decimal">
<li><p>Draw the number of generations <span class="math inline">\(g\)</span></p></li>
<li><p>Draw the generation sizes <span class="math inline">\(n_1, \dots, n_g\)</span> and index the nodes</p></li>
<li><p>Draw the infector ID for each node</p></li>
<li><p>Draw a permutation of the covariate labels to the <span class="math inline">\(n\)</span> nodes.</p></li>
</ol>
<div id="draw-the-generations-g" class="section level3">
<h3 class="hasAnchor">
<a href="#draw-the-generations-g" class="anchor"></a>Draw the generations <span class="math inline">\(g\)</span>
</h3>
<p>The number of generations <span class="math inline">\(g\)</span> is (for <span class="math inline">\(|C|=n &gt; 1\)</span>) <span class="math display">\[
Z ~ \sim Binomial(n-2, .5)\\
g \sim 2 + Z
\]</span> This variable <span class="math inline">\(g\)</span> comes from counting the number of ways to put <span class="math inline">\(n-1\)</span> <em>indistinguishable</em> individuals in <span class="math inline">\(g-1\)</span> parts, recalling that one individual is reserved for the first generation. There are <span class="math inline">\(n-2 \choose g-2\)</span> ways to do this according to the classic <a href="https://en.wikipedia.org/wiki/Stars_and_bars_(combinatorics)">Stars and Bars combinatorial problem</a>. So if we consider all the different ‘boxings’ for <span class="math inline">\(g=0, \dots, n-2\)</span>, then this is <span class="math inline">\(Z \sim Binomial(n-2, .5)\)</span></p>
</div>
<div id="draw-the-generation-sizes" class="section level3">
<h3 class="hasAnchor">
<a href="#draw-the-generation-sizes" class="anchor"></a>Draw the generation sizes</h3>
<p>Conditioned on the number of generations <span class="math inline">\(g\)</span>, we would like to uniformly draw a <span class="math inline">\(g-tuple\)</span> <span class="math inline">\((n_1, \dots, n_g)\)</span> such that <span class="math inline">\(n_1=1\)</span> and <span class="math inline">\(\sum_{i=1}^g n_i = n\)</span>.</p>
<p>To do this, we rely on the <code>R</code> packages <code>partitions</code> and <code>RcppAlgos</code>. The package <code>partitions</code> allows us to uniformly draw <em>partitions</em> <span class="math inline">\(n_1 = 1 \le n_2 \le \dots \le n_g\)</span>. We then have to uniquely ‘permute’ the partitions into the allowable set of <span class="math inline">\(g\)</span>-tuples which require no such ordering. The package <code>RcppAlgos</code> allows us to ‘permute’ these partitions where we now consider the values of <span class="math inline">\(n_2, \dots n_g\)</span> as tokens.</p>
<p>To help explain this better consider the following example with <span class="math inline">\(n= 7\)</span> and <span class="math inline">\(g=4\)</span>.</p>
<p>The unique <em>partitions</em> are</p>
<ul>
<li><p>(1, 2, 2, 2)</p></li>
<li><p>(1, 1, 2, 3)</p></li>
<li><p>(1, 1, 1, 4).</p></li>
</ul>
<p>Then the permutations of partitions are</p>
<ul>
<li><p>(1, 2, 2, 2)</p></li>
<li><p>(1, 1, 2, 3); (1, 1, 3, 2); (1, 2, 1, 3); (1, 2, 3, 1); (1, 3, 2, 1); (1, 3, 1, 2)</p></li>
<li><p>(1, 1, 1, 4); (1, 4, 1, 1); (1, 1, 4, 1).</p></li>
</ul>
<p>Note that each of the partitions has a different number of permutations depending on how many times a generation size appears in the partition. This is the most computationally expensive step.</p>
<p>Once we have these generation sizes we index the nodes with the ordered pair <span class="math inline">\(g^*, i^*\)</span>.</p>
</div>
<div id="draw-the-infector-ids" class="section level3">
<h3 class="hasAnchor">
<a href="#draw-the-infector-ids" class="anchor"></a>Draw the infector IDs</h3>
<p>For individual <span class="math inline">\(g^*, i^*\)</span> for <span class="math inline">\(g &gt; 1\)</span>, we draw an infector ID <span class="math inline">\((h, j)\)</span> by the following <span class="math display">\[
j \sim Categorical(n_{g^*-1}, 1 / n_{g^*-1})\\
h = g^*-1.
\]</span></p>
<p>That is, we randomly select an individual from the previous generation to be person <span class="math inline">\((g^*, i^*\)</span>)’s infector.</p>
</div>
<div id="drawing-the-covariates" class="section level3">
<h3 class="hasAnchor">
<a href="#drawing-the-covariates" class="anchor"></a>Drawing the covariates</h3>
<p>We then randomly permute the covariates/labels from the $C individuals in the clusters to the nodes in the transmission tree.</p>
</div>
</div>
<div id="relationship-between-mathcalt_c-and-mathcalf_c" class="section level2">
<h2 class="hasAnchor">
<a href="#relationship-between-mathcalt_c-and-mathcalf_c" class="anchor"></a>Relationship between <span class="math inline">\(\mathcal{T}_C\)</span> and <span class="math inline">\(\mathcal{F}_C\)</span>
</h2>
<p>The space of permissible trees, <span class="math inline">\(\mathcal{F}_C\)</span> for the multiple outside transmissions (MOT) model is described more fully <a href="multiple-outside-transmissions-model.html">here</a>. The MOT is formed by constructing a transmission tree of size <span class="math inline">\(|C|+1\)</span> where the root node is reserved for a latent outsider.</p>
<p>This means for an observed cluster <span class="math inline">\(C\)</span> with <span class="math inline">\(n\)</span> individuals if we impute outside characteristics <span class="math inline">\(O\)</span>, then we have made a new cluster of size <span class="math inline">\(n+1\)</span>. We can then sample transmission trees from <span class="math inline">\(\mathcal{T}_{\{O\cup C\}}\)</span> with one simple modification: we enforce the first node to have charateristics <span class="math inline">\(O\)</span> and permute the observed characteristics to the remaining nodes.</p>
<p>The consequence is we can re-use much of the work in sampling from <span class="math inline">\(\mathcal{T}_C\)</span> to sample from <span class="math inline">\(\mathcal{F}_C\)</span>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Shannon Gallagher, Dean Follmann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
