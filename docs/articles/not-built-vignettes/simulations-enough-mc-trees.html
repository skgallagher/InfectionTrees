<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Binary covariate model simulations • InfectionTrees</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Binary covariate model simulations">
<meta property="og:description" content="InfectionTrees">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">InfectionTrees</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/getting-started.html">Getting started with `InfectionTrees`</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/base-binary-simulations.html">Binary covariate model simulations</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/base-general-simulations.html">Multiple covariate model simulations</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/model-overview.html">The model</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/multiple-outside-binary-simulations.html">Binary covariate multiple outside transmissions model simulations</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/multiple-outside-transmissions-model.html">The multiple outside transmissions extension to the model</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/sampling-enough-mc-trees.html">Sampling enough MC trees</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/sampling-mc-trees.html">Sampling transmission trees given a cluster </a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/simulations-enough-mc-trees.html">Binary covariate model simulations</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/simulations-enough-mc-trees.html.html">Binary covariate multiple outside transmissions model simulations</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/tb-data-base.html">TB Data Results: base model</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/tb-data-vis.html">TB Data Results: Visualization of clusters</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/tb-eda.html">First look at the Tuberculosis datas</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/skgallagher/InfectionTrees/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simulations-enough-mc-trees_files/header-attrs-2.3/header-attrs.js"></script><script src="simulations-enough-mc-trees_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Binary covariate model simulations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/skgallagher/InfectionTrees/blob/master/vignettes/not-built-vignettes/simulations-enough-mc-trees.Rmd"><code>vignettes/not-built-vignettes/simulations-enough-mc-trees.Rmd</code></a></small>
      <div class="hidden name"><code>simulations-enough-mc-trees.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>In this vignette, we provide code to demonstrate the process to determine if we have sampled enough MC trees.</p>
</div>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>Since our model relies on approximating the likelihood of our data through Monte Carlos sampling of permissible transmission trees, we need to able to assess if we have sampled “enough” transmission trees. In <a href="sampling-enough-mc-trees.html">this vignette</a> we provide a process to determine exactly that. Basically we refit our model using different sets of MC samples and determine how much our coefficient estimates vary. If the standard errors of these coefficients are less than some threshold <span class="math inline">\(\tau\)</span>, then we say we our samples are enough. Otherwise we double the number of MC samples.</p>
</div>
<div id="simulation-code" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-code" class="anchor"></a>Simulation code</h2>
<p>We provide our code to determine if we have enough samples here.</p>
<div id="generate-data" class="section level3">
<h3 class="hasAnchor">
<a href="#generate-data" class="anchor"></a>Generate data</h3>
<p>We first generate data where the probability of infection is determined by a binary covariate (like in <a href="base-binary-simulations.html">this vignette</a>). This data consists of <span class="math inline">\(M=100\)</span> clusters.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2020</span>)
<span class="co">## Generate possible covariates </span>
<span class="no">sample_covariates_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">0</span>))

<span class="no">beta0</span> <span class="kw">&lt;-</span> -<span class="fl">2</span>
<span class="no">beta1</span> <span class="kw">&lt;-</span> <span class="fl">1.5</span>
<span class="no">M</span> <span class="kw">&lt;-</span> <span class="fl">1000</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/simulate_bp.html">simulate_bp</a></span>(<span class="kw">K</span> <span class="kw">=</span> <span class="no">M</span>,
                                  <span class="kw">inf_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">beta0</span>, <span class="no">beta1</span>),
                                  <span class="kw">sample_covariates_df</span> <span class="kw">=</span> <span class="no">sample_covariates_df</span>,
                                  <span class="kw">covariate_names</span> <span class="kw">=</span> <span class="st">"x"</span>,
                                  <span class="kw">max_size</span> <span class="kw">=</span> <span class="fl">50</span>)

 <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu">group_by</span>(<span class="no">cluster_id</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="kw">cluster_size</span> <span class="kw">=</span> <span class="fu">n</span>()) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
   <span class="fu">group_by</span>(<span class="no">cluster_size</span>) <span class="kw">%&gt;%</span>
   <span class="fu">summarize</span>(<span class="kw">freq</span> <span class="kw">=</span> <span class="fu">n</span>()) <span class="kw">%&gt;%</span>
   <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"html"</span>) <span class="kw">%&gt;%</span>
   <span class="fu">kable_styling</span>(<span class="kw">bootstrap_options</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>), <span class="kw">full_width</span> <span class="kw">=</span> <span class="no">F</span>,
                 <span class="kw">position</span> <span class="kw">=</span> <span class="st">"center"</span>)</pre></body></html></div>
<table class="table table table-striped table-hover table-condensed">
<thead><tr>
<th style="text-align:right;">
cluster_size
</th>
<th style="text-align:right;">
freq
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
763
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
127
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>We then fit our model to the generated data using <span class="math inline">\(B=5\)</span> sets of MC samples and record the estimates for each where we sample <span class="math inline">\(K= 5000\)</span> for each set.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co">## Summarize data set into a table</span>
<span class="no">binary_cluster_summaries</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/summarize_binary_clusters.html">summarize_binary_clusters</a></span>(<span class="no">data</span>)

<span class="no">B</span> <span class="kw">&lt;-</span> <span class="fl">5</span>
<span class="no">K</span> <span class="kw">&lt;-</span> <span class="fl">5000</span>

<span class="no">beta_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">0</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="no">B</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">var_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">0</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="no">B</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">seed</span> <span class="kw">&lt;-</span> <span class="fl">9152020</span>

<span class="kw">for</span>(<span class="no">bb</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">B</span>){

    <span class="co">## Get different seeds for MC sets</span>
  <span class="no">seed</span> <span class="kw">&lt;-</span> <span class="no">seed</span> + <span class="no">bb</span> * <span class="fl">10</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="no">seed</span>)

  <span class="co">## Sample MC trees</span>
  <span class="no">mc_trees</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/sample_mc_binary_cov.html">sample_mc_binary_cov</a></span>(<span class="no">K</span>,
                                 <span class="kw">observed_cluster_summaries</span> <span class="kw">=</span> <span class="no">binary_cluster_summaries</span>)

  <span class="co">## Fit model</span>
  <span class="no">inf_params_0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>)

  <span class="no">best_params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span>(<span class="no">inf_params_0</span>, <span class="kw">fn</span> <span class="kw">=</span> <span class="no">bp_loglike_binary_cov</span>,
                      <span class="kw">mc_samples_summary</span> <span class="kw">=</span> <span class="no">mc_trees</span>,
                                  <span class="kw">return_neg</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                     <span class="kw">method</span> <span class="kw">=</span> <span class="st">"L-BFGS-B"</span>,
                     <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>, -<span class="fl">5</span>),
                     <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>, <span class="fl">5</span>),
                     <span class="kw">hessian</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

  <span class="no">beta_mat</span>[<span class="no">bb</span>,] <span class="kw">&lt;-</span> <span class="no">best_params</span>$<span class="no">par</span>
  <span class="no">var_mat</span>[<span class="no">bb</span>,] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span>(<span class="no">best_params</span>$<span class="no">hessian</span>))


}</pre></body></html></div>
<p>We can evaluate the Wald statistics, first using the Fisher information matrix estimate of the standard error and then the empirical standard error from the simulations.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">wald_scores_fisher</span> <span class="kw">&lt;-</span> <span class="no">beta_mat</span> / <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">var_mat</span>)
<span class="no">wald_se_fisher</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">wald_scores_fisher</span>, <span class="fl">2</span>, <span class="no">sd</span>)

<span class="no">se_emp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">beta_mat</span>, <span class="fl">2</span>, <span class="no">sd</span>)


<span class="no">wald_se_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">wald_se_fisher</span>, <span class="no">se_emp</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">wald_se_mat</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Fisher"</span>, <span class="st">"Emp."</span>)

<span class="fu">kable</span>(<span class="no">wald_se_mat</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">kable_styling</span>(<span class="kw">bootstrap_options</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</pre></body></html></div>
<table class="table table table-striped table-hover table-condensed"><tbody>
<tr>
<td style="text-align:left;">
Fisher
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.09
</td>
</tr>
<tr>
<td style="text-align:left;">
Emp.
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.02
</td>
</tr>
</tbody></table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Shannon Gallagher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
